!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("vue")):"function"==typeof define&&define.amd?define(["vue"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).VirtualDragList=e(t.Vue)}(this,function(j){"use strict";function i(e,t){var n,i=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)),i}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){a(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function t(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function F(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function H(r,t,e){function n(){for(var t,e=this,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return a&&clearTimeout(a),h?(t=!a,a=setTimeout(function(){a=null},l),t&&(s=r.apply(this,i))):a=setTimeout(function(){r.apply(e,i)},l),s}var a,s,l=1<arguments.length&&void 0!==t?t:50,h=2<arguments.length&&void 0!==e&&e;return n.prototype.cancel=function(){clearTimeout(a),a=null},n}var l,h,u,e,c,d,f,g,p,v,y,m,b;function S(t){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function w(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function E(t,e,n){return e&&w(t.prototype,e),n&&w(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function x(t){return function(t){if(Array.isArray(t))return D(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return D(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function k(t){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(t)}function T(e,n){n?"none"===n?f.forEach(function(t){return K(e,t,"none")}):f.forEach(function(t){return K(e,t,"".concat(t.split("transition")[0],"transform ").concat(n))}):f.forEach(function(t){return K(e,t,"")})}function O(e,n){n?g.forEach(function(t){return K(e,t,"".concat(t.split("transform")[0]).concat(n))}):g.forEach(function(t){return K(e,t,"")})}function _(t){var e=t.touches&&t.touches[0]||t.pointerType&&"touch"===t.pointerType&&t,t=e||t;return{touch:e,e:t,target:e?document.elementFromPoint(t.clientX,t.clientY):t.target}}function z(t,e,n){window.addEventListener?t.addEventListener(e,n,!(!p&&l)&&c):window.attachEvent&&t.attachEvent("on"+e,n)}function C(t,e,n){window.removeEventListener?t.removeEventListener(e,n,!(!p&&l)&&c):window.detachEvent&&t.detachEvent("on"+e,n)}function I(t){var e={top:0,left:0,height:0,width:0};e.height=t.offsetHeight,e.width=t.offsetWidth,e.top=t.offsetTop,e.left=t.offsetLeft;for(var n=t.offsetParent;null!==n;)e.top+=n.offsetTop,e.left+=n.offsetLeft,n=n.offsetParent;return e}function M(t,e){if(!t||!t.getBoundingClientRect)return A();var n=t,i=!1;do{if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){var o=K(n);if(n.clientWidth<n.scrollWidth&&("auto"==o.overflowX||"scroll"==o.overflowX)||n.clientHeight<n.scrollHeight&&("auto"==o.overflowY||"scroll"==o.overflowY)){if(!n.getBoundingClientRect||n===document.body)return A();if(i||e)return n;i=!0}}}while(n=n.parentNode);return A()}function A(){var t=document.scrollingElement;return!t||t.contains(document.body)?document:t}function P(t){if(t.getBoundingClientRect||t===window){var e={top:0,left:0,bottom:0,right:0,height:0,width:0};return t!==window&&t.parentNode&&t!==A()?(t=t.getBoundingClientRect(),e.top=t.top,e.left=t.left,e.bottom=t.bottom,e.right=t.right,e.height=t.height,e.width=t.width):(e.top=0,e.left=0,e.bottom=window.innerHeight,e.right=window.innerWidth,e.height=window.innerHeight,e.width=window.innerWidth),e}}function $(t,e,n){var i=x(Array.from(t.children)),t=i.indexOf(e);if(-1<t)return n?i[t]:{index:t,el:i[t],rect:P(i[t]),offset:I(i[t])};for(var o=0;o<i.length;o++)if(function(t,e){var n;if(t&&e)for(n=t.parentNode;n;){if(e===n)return!0;n=n.parentNode}return!1}(e,i[o]))return n?i[o]:{index:o,el:i[o],rect:P(i[o]),offset:I(i[o])};return n?null:{index:-1,el:null,rect:{},offset:{}}}function B(t,e,n){var i;t&&e&&(t.classList?t.classList[n?"add":"remove"](e):(i=(" "+t.className+" ").replace(d," ").replace(" "+e+" "," "),t.className=(i+(n?" "+e:"")).replace(d," ")))}function K(t,e,n){var i=t&&t.style;if(i){if(void 0===n)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(n=t.currentStyle),void 0===e?n:n[e];i[e=!(e in i||-1!==e.indexOf("webkit"))?"-webkit-"+e:e]=n+("string"==typeof n?"":"px")}}function R(n,i,o){var r=null;return function(){var t=this,e=arguments;r&&clearTimeout(r),o&&!r&&n.apply(t,e),r=setTimeout(function(){n.apply(t,e)},i)}}function N(n,i){var o=null;return function(){var t=this,e=arguments;o=o||setTimeout(function(){o=null,n.apply(t,e)},i)}}function q(){var o=[];return{captureAnimationState:function(){var t,e=x(Array.from(this.rootEl.children)),n=(t=e,i=this.dragEl,n=this.dropEl,i=t.indexOf(i),n=t.indexOf(n),i<n?{start:i,end:n}:{start:n,end:i}),i=n.start,n=n.end;o.length=0,e.slice(i,n+1).forEach(function(t){o.push({target:t,rect:P(t)})})},animateRange:function(){var n=this;o.forEach(function(t){var e=t.target,t=t.rect;n.animate(e,t,n.options.animation)})},animate:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:150,i=P(t),o=e.left-i.left,i=e.top-i.top;T(t,"none"),O(t,"translate3d(".concat(o,"px, ").concat(i,"px, 0)")),t.offsetLeft,T(t,"".concat(n,"ms")),O(t,"translate3d(0px, 0px, 0px)"),clearTimeout(t.animated),t.animated=setTimeout(function(){T(t,""),O(t,""),t.animated=null},n)}}}function U(t,e){if(!t||!t.nodeType||1!==t.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.rootEl=t,this.scrollEl=M(t,!0),this.options=e=Object.assign({},e),this.ownerDocument=t.ownerDocument;var n,i={autoScroll:!0,scrollStep:5,scrollThreshold:15,delay:0,delayOnTouchOnly:!1,disabled:!1,animation:150,ghostAnimation:0,ghostClass:"",ghostStyle:{},chosenClass:"",draggable:void 0,dragging:void 0,onDrag:void 0,onMove:void 0,onDrop:void 0,onChange:void 0,fallbackOnBody:!1,forceFallback:!1,stopPropagation:!1,supportPointer:"PointerEvent"in window&&!u,supportTouch:"ontouchstart"in window};for(n in i)n in this.options||(this.options[n]=i[n]);this.container=this.options.fallbackOnBody?document.body:this.rootEl,this.nativeDraggable=!this.options.forceFallback&&b,this.move={x:0,y:0},this.state=new v,this.differ=new y,this.ghost=new m(this),this.dragEl=null,this.dropEl=null,this.dragStartTimer=null,this.autoScrollTimer=null,Object.assign(this,{_bindEventListener:function(){this._onDrag=this._onDrag.bind(this),this._onMove=this._onMove.bind(this),this._onDrop=this._onDrop.bind(this);var t=this.options,e=t.supportPointer,t=t.supportTouch;z(this.rootEl,e?"pointerdown":t?"touchstart":"mousedown",this._onDrag)},_clearEvent:function(){C(this.rootEl,"pointerdown",this._onDrag),C(this.rootEl,"touchstart",this._onDrag),C(this.rootEl,"mousedown",this._onDrag)},_bindMoveEvents:function(t){this.options.supportPointer?z(this.ownerDocument,"pointermove",this._onMove):z(this.ownerDocument,t?"touchmove":"mousemove",this._onMove)},_unbindMoveEvents:function(){C(this.ownerDocument,"pointermove",this._onMove),C(this.ownerDocument,"touchmove",this._onMove),C(this.ownerDocument,"mousemove",this._onMove)},_unbindDropEvents:function(){C(this.ownerDocument,"pointerup",this._onDrop),C(this.ownerDocument,"pointercancel",this._onDrop),C(this.ownerDocument,"touchend",this._onDrop),C(this.ownerDocument,"touchcancel",this._onDrop),C(this.ownerDocument,"mouseup",this._onDrop)},_unbindDragEvents:function(){this.nativeDraggable&&(C(this.rootEl,"dragstart",this._onDragStart),C(this.rootEl,"dragover",this._onDragOver),C(this.rootEl,"dragend",this._onDrop))}},q(),(window.requestAnimationFrame||(window.requestAnimationFrame=function(t){return setTimeout(t,17)}),{_autoScroll:N(function(t){var e,n,i,o,r,a,s,l,h,u,c,d,f,g,p;t.state.sortableDown&&t.state.sortableMove&&(f=(h=t.state.sortableMove).clientX,e=h.clientY,void 0!==f&&void 0!==e&&(t.scrollEl===t.ownerDocument||(n=(c=t.scrollEl).scrollTop,i=c.scrollLeft,o=c.scrollHeight,r=c.scrollWidth,a=(u=P(t.scrollEl)).top,s=u.right,g=u.bottom,d=u.left,l=u.height,h=u.width,u=(c=t.options).scrollStep,c=c.scrollThreshold,d=0<i&&d<=f&&f<=d+c,f=i+h<r&&f<=s&&s-c<=f,g=n+l<o&&e<=g&&g-c<=e,p={x:i,y:n},(c=0<n&&a<=e&&e<=a+c)?(p.x=d?i-u:f?i+u:i,p.y=n-u):g?(p.x=d?i-u:f?i+u:i,p.y=n+u):d?(p.x=i-u,p.y=n):f&&(p.x=i+u,p.y=n),(c||d||f||g)&&requestAnimationFrame(function(){t.scrollEl.scrollTo(p.x,p.y),t._autoScroll(t)}))))},10)})),this._bindEventListener()}function W(n,i,o){function t(){var t=n.event,e=n.dataKey;o(t,e,null!=i&&i.value?i.value[r.value]:0)}var e=null,r=j.computed(function(){return n.isHorizontal?"offsetWidth":"offsetHeight"});j.onMounted(function(){"undefined"!=typeof ResizeObserver&&(e=new ResizeObserver(function(){t()}),null!=i&&i.value&&e.observe(i.value))}),j.onUpdated(function(){t()}),j.onUnmounted(function(){e&&(e.disconnect(),e=null)})}var X=(l=k(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),h=k(/Edge/i),u=k(/safari/i)&&!k(/chrome/i)&&!k(/android/i),ot=k(/iP(ad|od|hone)/i),e=k(/chrome/i)&&k(/android/i),c={capture:!1,passive:!1},d=/\s+/g,f=["-webkit-transition","-moz-transition","-ms-transition","-o-transition","transition"],g=["-webkit-transform","-moz-transform","-ms-transform","-o-transform","transform"],p=function(){var t=!1;return document.addEventListener("checkIfSupportPassive",null,{get passive(){return t=!0}}),t}(),v=E(function t(){n(this,t),this.sortableDown=void 0,this.sortableMove=void 0,this.animationEnd=void 0}),y=function(){function t(){n(this,t),this.from={node:null,rect:{},offset:{}},this.to={node:null,rect:{},offset:{}}}return E(t,[{key:"get",value:function(t){return this[t]}},{key:"set",value:function(t,e){this[t]=e}},{key:"destroy",value:function(){this.from={node:null,rect:{},offset:{}},this.to={node:null,rect:{},offset:{}}}}]),t}(),m=function(){function e(t){n(this,e),this.$el=null,this.distance={x:0,y:0},this.options=t.options,this.container=t.container}return E(e,[{key:"init",value:function(t,e){var n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];this.$el=t;var i=this.options,t=i.ghostClass,i=i.ghostStyle,i=void 0===i?{}:i;B(this.$el,t,!0),K(this.$el,"box-sizing","border-box"),K(this.$el,"margin",0),K(this.$el,"top",e.top),K(this.$el,"left",e.left),K(this.$el,"width",e.width),K(this.$el,"height",e.height),K(this.$el,"opacity","0.8"),K(this.$el,"position","fixed"),K(this.$el,"zIndex","100000"),K(this.$el,"pointerEvents","none"),this.setStyle(i),T(this.$el,"none"),O(this.$el,"translate3d(0px, 0px, 0px)"),n&&this.container.appendChild(this.$el),K(this.$el,"transform-origin",this.distance.x/parseInt(this.$el.style.width)*100+"% "+this.distance.y/parseInt(this.$el.style.height)*100+"%")}},{key:"setStyle",value:function(t){for(var e in t)K(this.$el,e,t[e])}},{key:"rect",value:function(){return P(this.$el)}},{key:"move",value:function(t,e){this.$el&&(T(this.$el,2<arguments.length&&void 0!==arguments[2]&&arguments[2]?"".concat(this.options.ghostAnimation,"ms"):"none"),O(this.$el,"translate3d(".concat(t,"px, ").concat(e,"px, 0)")))}},{key:"destroy",value:function(t){var e,n,i=this;this.$el&&(e=parseInt(this.$el.style.left),n=parseInt(this.$el.style.top),this.move(t.left-e,t.top-n,!0),(n=this.options.ghostAnimation)?setTimeout(function(){return i.clear()},n):this.clear())}},{key:"clear",value:function(){this.$el&&this.$el.remove(),this.distance={x:0,y:0},this.$el=null}}]),e}(),b="undefined"!=typeof document&&!e&&!ot&&"draggable"in document.createElement("div"),(U.prototype={constructor:U,destroy:function(){this._clearState(),this._clearEvent(),Array.prototype.forEach.call(this.rootEl.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")})},set:function(t,e){this.options[t]=e},get:function(t){return this.options[t]},_onDrag:function(t){var e=this;if(!(/mousedown|pointerdown/.test(t.type)&&0!==t.button||this.options.disabled)){var n=_(t),i=n.touch,o=n.e,r=n.target;if(this.nativeDraggable||!u||!r||"SELECT"!==r.tagName.toUpperCase()){if(r===this.rootEl)return!0;this.options.stopPropagation&&t.stopPropagation();n=this.options,t=n.draggable,n=n.dragging;if("function"==typeof t){if(!t(o))return!0}else if("string"==typeof t){if(!function(t,e){if(e){if(">"===e[0]&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch(t){return!1}return!1}}(r,t))return!0}else if(void 0!==t)throw new Error('draggable expected "function" or "string" but received "'.concat(S(t),'"'));if(n){if("function"!=typeof n)throw new Error('dragging expected "function" or "string" but received "'.concat(S(n),'"'));this.dragEl=n(o)}else this.dragEl=$(this.rootEl,r,!0);if(!this.dragEl||this.dragEl.animated)return!0;i&&(this.dragEl.style["touch-action"]="none");n=$(this.rootEl,this.dragEl),r=n.rect,n=n.offset;this.move={x:o.clientX,y:o.clientY},this.differ.from={node:this.dragEl,rect:r,offset:n},this.ghost.distance={x:o.clientX-r.left,y:o.clientY-r.top},this.state.sortableDown=o,z(this.ownerDocument,"pointerup",this._onDrop),z(this.ownerDocument,"touchend",this._onDrop),z(this.ownerDocument,"mouseup",this._onDrop);n=this.options,r=n.delay,n=n.delayOnTouchOnly;!r||n&&!i||this.nativeDraggable&&(h||l)?this._onStart(o,i):(clearTimeout(this.dragStartTimer),this.dragStartTimer=setTimeout(function(){return e._onStart(o,i)},r))}}},_onStart:function(t,e){!this.nativeDraggable||e?(this._bindMoveEvents(e),z(this.ownerDocument,"pointercancel",this._onDrop),z(this.ownerDocument,"touchcancel",this._onDrop)):(this.dragEl.draggable=!0,this._onDragStart=this._onDragStart.bind(this),this._onDragOver=this._onDragOver.bind(this),z(this.rootEl,"dragstart",this._onDragStart));try{document.selection?setTimeout(function(){document.selection.empty()},0):window.getSelection().removeAllRanges()}catch(t){}},_onDragStart:function(t){t.dataTransfer.setData("te",t.target.innerText),z(this.rootEl,"dragover",this._onDragOver),z(this.rootEl,"dragend",this._onDrop)},_onDragOver:function(t){var e,n,i,o;this.state.sortableDown&&(this.options.stopPropagation&&t.stopPropagation&&t.stopPropagation(),void 0!==t.preventDefault&&t.cancelable&&t.preventDefault(),e=t.clientX,n=t.clientY,i=e-this.move.x,o=n-this.move.y,void 0!==e&&Math.abs(i)<=0&&void 0!==n&&Math.abs(o)<=0||(this._onStarted(t,t),t.target!==this.rootEl&&this._onChange(this,t.target,t,t)))},_onMove:function(t){var e,n,i,o,r,a,s,l,h=this;this.state.sortableDown&&(e=(r=_(t)).e,n=r.target,i=e.clientX,o=e.clientY,a=i-this.move.x,s=o-this.move.y,void 0!==i&&Math.abs(a)<=0&&void 0!==o&&Math.abs(s)<=0||(this.options.stopPropagation&&t.stopPropagation&&t.stopPropagation(),void 0!==t.preventDefault&&t.cancelable&&t.preventDefault(),this._onStarted(e,t),this.ghost.move(a,s),(l=this.options.onMove)&&"function"==typeof l&&l(this.differ.from,this.ghost.$el,e,t),i<0||o<0||(a=(r=P(this.rootEl)).top,s=r.right,l=r.bottom,i<r.left||s<i||o<a||l<o||(this._onChange(this,n,e,t),this.autoScrollTimer&&clearTimeout(this.autoScrollTimer),this.options.autoScroll&&(this.autoScrollTimer=setTimeout(function(){return h._autoScroll(h)},0))))))},_onStarted:function(t,e){var n;this.state.sortableMove=t,this.ghost.$el||((n=this.options.onDrag)&&"function"==typeof n&&n(this.dragEl,t,e),t=this.differ.from.rect,e=this.dragEl.cloneNode(!0),this.ghost.init(e,t,!this.nativeDraggable),B(this.dragEl,this.options.chosenClass,!0),this.dragEl.style["will-change"]="transform",u&&K(document.body,"user-select","none"),this.nativeDraggable&&this._unbindDropEvents())},_onChange:R(function(t,e,n,i){var o,r,a,s,l=$(t.rootEl,e),h=l.el,u=l.rect,c=l.offset;h&&!h.animated&&(t.dropEl=h,o=n.clientX,r=n.clientY,a=u.left,s=u.right,e=u.top,l=u.bottom,a<o&&o<s&&e<r&&r<l&&h!==t.dragEl&&(t.differ.to={node:t.dropEl,rect:u,offset:c},t.captureAnimationState(),l=t.options.onChange,u=I(t.dragEl),l&&"function"==typeof l&&l(t.differ.from,t.differ.to,n,i),u.top<c.top||u.left<c.left?t.rootEl.insertBefore(t.dragEl,h.nextElementSibling):t.rootEl.insertBefore(t.dragEl,h),t.animateRange()))},5),_onDrop:function(t){this._unbindDragEvents(),this._unbindMoveEvents(),this._unbindDropEvents(),this.dragStartTimer&&clearTimeout(this.dragStartTimer),this.options.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault();var e,n=_(t).touch;B(this.dragEl,this.options.chosenClass,!1),this.nativeDraggable&&(this.dragEl.draggable=!1),n&&(this.dragEl.style["touch-action"]=""),this.dragEl.style["will-change"]="",this.state.sortableDown&&this.state.sortableMove&&(this.differ.to.offset=I(this.dragEl),this.differ.to.rect=P(this.dragEl),n=(e=this.differ).from,e=e.to,n=n.offset.top!==e.offset.top||n.offset.left!==e.offset.left,(e=this.options.onDrop)&&"function"==typeof e&&e(n,t)),u&&K(document.body,"user-select",""),this.ghost.destroy(this.differ.to.rect),this.state=new v},_clearState:function(){this.state=new v,this.differ.destroy(),this.dragEl=null,this.dropEl=null}}).utils={getRect:P,getOffset:I,debounce:R,throttle:N,getParentAutoScrollElement:M},U),Y=t(function t(){o(this,t),a(this,"from",void 0),a(this,"to",void 0),this.from={key:void 0,item:void 0,index:-1},this.to={key:void 0,item:void 0,index:-1}}),V=function(){function i(t,e,n){o(this,i),a(this,"onDrag",void 0),a(this,"onDrop",void 0),a(this,"dragState",void 0),a(this,"dragElement",void 0),a(this,"drag",void 0),a(this,"options",void 0),a(this,"dataSource",void 0),a(this,"cloneList",void 0),a(this,"rangeIsChanged",void 0),this.options=t,this.onDrag=e,this.onDrop=n,this.dataSource=t.dataSource,this.cloneList=new Array,this.dragState=new Y,this.rangeIsChanged=!1,t.scrollEl&&this.init()}return t(i,[{key:"set",value:function(t,e){this[t]=e,"dataSource"===t&&this.dragElement&&this.dragStart(this.dragElement,!1)}},{key:"setOption",value:function(t,e){this.options[t]=e,this.drag.set(t,e)}},{key:"init",value:function(){var n=this,t=this.options,e=t.disabled,i=t.draggable,o=t.ghostClass,r=t.ghostStyle,a=t.chosenClass,s=t.animation,l=t.autoScroll,h=t.scrollStep,t=t.scrollThreshold;this.drag=new X(this.options.scrollEl,{disabled:e,draggable:i,ghostClass:o,ghostStyle:r,chosenClass:a,animation:s,autoScroll:l,scrollStep:h,scrollThreshold:t,onChange:function(t,e){return n.onChange(t,e)},onDrag:function(t){return n.dragStart(t)},onDrop:function(t){return n.dragEnd(t)}})}},{key:"dragStart",value:function(t){var n=this,e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this.dragElement=t,this.cloneList=F(this.dataSource);var i=t.getAttribute("data-key");this.dataSource.forEach(function(t,e){n.options.getKey(t)==i&&(n.dragState.from={item:t,index:e,key:i})}),e?(this.rangeIsChanged=!1,this.onDrag(this.dragState.from,t)):this.rangeIsChanged=!0}},{key:"onChange",value:function(t,e){var i=this,o=this.dragState.from.key,r=e.node.getAttribute("data-key"),a={item:null,index:-1},s={item:null,index:-1};this.cloneList.forEach(function(t,e){var n=i.options.getKey(t);n==o&&Object.assign(a,{item:t,index:e}),n==r&&Object.assign(s,{item:t,index:e})}),this.cloneList.splice(a.index,1),this.cloneList.splice(s.index,0,a.item)}},{key:"dragEnd",value:function(t){var n=this,i=this.options.getKey;this.rangeIsChanged&&this.dragElement&&this.dragElement.remove();var o=this.dragState.from;this.cloneList.forEach(function(t,e){i(t)==o.key&&(n.dragState.to={index:e,key:i(n.dataSource[e]),item:n.dataSource[e]})}),this.onDrop(this.cloneList,o,this.dragState.to,t),this.dataSource=F(this.cloneList),this.clear()}},{key:"clear",value:function(){this.dragElement=null,this.rangeIsChanged=!1,this.dragState=new Y}},{key:"destroy",value:function(){this.drag&&this.drag.destroy(),this.drag=null}}]),i}(),G=t(function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};o(this,t),a(this,"start",void 0),a(this,"end",void 0),a(this,"front",void 0),a(this,"behind",void 0),this.start=e.start||0,this.end=e.end||0,this.front=e.front||0,this.behind=e.behind||0}),J=t(function t(){o(this,t),a(this,"average",void 0),a(this,"total",void 0),a(this,"fixed",void 0),a(this,"header",void 0),a(this,"footer",void 0),this.average=0,this.total=0,this.fixed=0,this.header=0,this.footer=0}),Q="INIT",Z="FIXED",tt="DYNAMIC",et="FRONT",nt="BEHIND",it=function(){function n(t,e){o(this,n),a(this,"options",void 0),a(this,"callback",void 0),a(this,"sizes",void 0),a(this,"isHorizontal",void 0),a(this,"calcIndex",void 0),a(this,"calcType",void 0),a(this,"calcSize",void 0),a(this,"range",void 0),a(this,"direction",void 0),a(this,"offset",void 0),this.options=L({},t),this.callback=e,this.sizes=new Map,this.isHorizontal=t.isHorizontal,this.calcIndex=0,this.calcType=Q,this.calcSize=new J,this.direction="",this.offset=0,this.range=Object.create(null),t&&this.checkIfUpdate(0,t.keeps-1)}return t(n,[{key:"updateUniqueKeys",value:function(t){this.options.uniqueKeys=t}},{key:"updateSizes",value:function(n){var i=this;this.sizes.forEach(function(t,e){n.includes(e)||i.sizes.delete(e)})}},{key:"updateRange",value:function(){var t=this,e=Math.max(this.range.start,0),n=Math.min(this.options.keeps,this.options.uniqueKeys.length);this.sizes.size>=n-2?this.handleUpdate(e,this.getEndByStart(e)):window.requestAnimationFrame?window.requestAnimationFrame(function(){return t.updateRange()}):setTimeout(function(){return t.updateRange()},3)}},{key:"handleScroll",value:function(t){this.direction=t<this.offset?et:nt,this.offset=t;t=this.getScrollItems(t);this.isFront()?this.handleScrollFront(t):this.isBehind()&&this.handleScrollBehind(t)}},{key:"isFront",value:function(){return this.direction===et}},{key:"isBehind",value:function(){return this.direction===nt}},{key:"isFixed",value:function(){return this.calcType===Z}},{key:"getScrollItems",value:function(t){var e=this.calcSize,n=e.fixed,e=e.header;if(e&&(t-=e),t<=0)return 0;if(this.isFixed())return Math.floor(t/n);for(var i,o,r=0,a=this.options.uniqueKeys.length;r<=a;){if(i=r+Math.floor((a-r)/2),(o=this.getOffsetByIndex(i))===t)return i;o<t?r=i+1:t<o&&(a=i-1)}return 0<r?--r:0}},{key:"handleScrollFront",value:function(t){t>this.range.start||(t=Math.max(t-Math.round(this.options.keeps/3),0),this.checkIfUpdate(t,this.getEndByStart(t)))}},{key:"handleScrollBehind",value:function(t){t<this.range.start+Math.round(this.options.keeps/3)||this.checkIfUpdate(t,this.getEndByStart(t))}},{key:"checkIfUpdate",value:function(t,e){var n=this.options,i=n.uniqueKeys,n=n.keeps;i.length<=n?(t=0,e=i.length-1):e-t<n-1&&(t=e-n+1),this.range.start!==t&&this.handleUpdate(t,e)}},{key:"handleUpdate",value:function(t,e){this.range.start=t,this.range.end=e,this.range.front=this.getFrontOffset(),this.range.behind=this.getBehindOffset(),this.callback(L({},this.range))}},{key:"getFrontOffset",value:function(){return this.isFixed()?this.calcSize.fixed*this.range.start:this.getOffsetByIndex(this.range.start)}},{key:"getBehindOffset",value:function(){var t=this.getLastIndex();return this.isFixed()?(t-this.range.end)*this.calcSize.fixed:this.calcIndex===t?this.getOffsetByIndex(t)-this.getOffsetByIndex(this.range.end):(t-this.range.end)*this.getItemSize()}},{key:"getOffsetByIndex",value:function(t){if(!t)return 0;for(var e=0,n=0;n<t;n++){var i=this.sizes.get(this.options.uniqueKeys[n]);e+="number"==typeof i?i:this.getItemSize()}return this.calcIndex=Math.max(this.calcIndex,t-1),this.calcIndex=Math.min(this.calcIndex,this.getLastIndex()),e}},{key:"getEndByStart",value:function(t){return Math.min(t+this.options.keeps-1,this.getLastIndex())}},{key:"getLastIndex",value:function(){var t=this.options,e=t.uniqueKeys,t=t.keeps;return 0<e.length?e.length-1:t-1}},{key:"getItemSize",value:function(){return this.isFixed()?this.calcSize.fixed:this.calcSize.average||this.options.size}},{key:"handleItemSizeChange",value:function(t,e){this.sizes.set(t,e),this.calcType===Q?(this.calcType=Z,this.calcSize.fixed=e):this.isFixed()&&this.calcSize.fixed!==e&&(this.calcType=tt,this.calcSize.fixed=0),this.calcType!==Z&&(this.calcSize.total=F(this.sizes.values()).reduce(function(t,e){return t+e},0),this.calcSize.average=Math.round(this.calcSize.total/this.sizes.size))}},{key:"handleHeaderSizeChange",value:function(t){this.calcSize.header=t}},{key:"handleFooterSizeChange",value:function(t){this.calcSize.footer=t}}]),n}(),ot={tag:{type:String,default:"div"},event:{type:String},dataKey:{type:[String,Number]},isHorizontal:{type:Boolean}},rt=j.defineComponent({name:"virtual-draglist-items",props:ot,setup:function(n,t){var e=t.emit,i=t.slots,o=j.ref(null);return W(n,o,e),function(){var t=n.tag,e=n.dataKey;return j.h(t,{ref:o,key:e,attrs:{"data-key":e}},null===(e=i.default)||void 0===e?void 0:e.call(i))}}}),at=j.defineComponent({name:"virtual-draglist-slots",props:ot,setup:function(n,t){var e=t.emit,i=t.slots,o=j.ref(null);return W(n,o,e),function(){var t=n.tag,e=n.dataKey;return j.h(t,{ref:o,key:e,attrs:{"data-key":e}},null===(e=i.default)||void 0===e?void 0:e.call(i))}}});return j.defineComponent({props:{dataSource:{type:Array,default:function(){return[]}},dataKey:{type:String,required:!0},direction:{type:String,default:"vertical"},keeps:{type:Number,default:30},size:{type:Number},delay:{type:Number,default:10},rootTag:{type:String,default:"div"},wrapTag:{type:String,default:"div"},wrapClass:{type:String,default:""},wrapStyle:{type:Object},headerTag:{type:String,default:"div"},footerTag:{type:String,default:"div"},itemTag:{type:String,default:"div"},itemStyle:{type:Object},itemClass:{type:String,default:""},disabled:{type:Boolean,default:!1},draggable:{type:[Function,String]},dragging:{type:Function},ghostClass:{type:String,default:""},ghostStyle:{type:Object,default:function(){return{}}},chosenClass:{type:String,default:""},animation:{type:Number,default:150},autoScroll:{type:Boolean,default:!0},scrollStep:{type:Number,default:5},scrollThreshold:{type:Number,default:15},keepOffset:{type:Boolean,default:!1}},emits:["top","bottom","ondragstart","ondragend"],setup:function(h,t){var u,o,i=this,r=t.emit,c=t.slots,d=j.ref(new G),f=j.ref(new Y),g=j.ref(null),p=j.ref(null),v=j.ref(null),y=j.ref([]),a=j.ref([]),e=null,m="vertical"!==h.direction,s=m?"scrollWidth":"scrollHeight",n=m?"scrollLeft":"scrollTop",l=m?"offsetLeft":"offsetTop",b=m?"clientWidth":"clientHeight";function S(){return g.value?Math.ceil(g.value[n]):0}function w(t){var e;t>=y.value.length-1?function t(){v.value&&(E(v.value[l]),setTimeout(function(){g.value&&S()+Math.ceil(g.value[b])<Math.ceil(g.value[s])&&t()},5))}():void 0!==(e=o.getOffsetByIndex(t))&&(E(e),setTimeout(function(){S()!==o.getOffsetByIndex(t)&&w(t)},5))}function E(t){g.value&&(g.value[n]=t)}function x(t,e){o.handleItemSizeChange(t,e)}function D(t,e){o.handleHeaderSizeChange(e)}function k(t,e){o.handleFooterSizeChange(e)}var T,O,_,z=function(){a.value=y.value.map(function(t){return $(t)})},C=function(){u=new V({scrollEl:p.value,dataSource:y.value,getKey:$,animation:h.animation,autoScroll:h.autoScroll,scrollStep:h.scrollStep,scrollThreshold:h.scrollThreshold,disabled:h.disabled,draggable:h.draggable,ghostClass:h.ghostClass,ghostStyle:h.ghostStyle,chosenClass:h.chosenClass},function(t,e){f.value.from=t,r("ondragstart",y.value,t,e)},function(t,e,n,i){f.value.to=n,r("ondragend",t,e,n,i),i&&(u.rangeIsChanged&&o.direction&&0<d.value.start&&(-1<(i=t.indexOf(y.value[d.value.start]))&&(d.value.start=i,d.value.end=i+h.keeps-1)),y.value=F(t),z(),o.updateUniqueKeys(a.value)),I()})},I=(T=function(){f.value=new Y},O=h.delay+17,_=null,function(){var t=this,e=arguments;_=_||setTimeout(function(){_=null,T.apply(t,e)},O)}),M=H(function(){var t,e,n;void 0===f.value.to.key?g.value&&(t=S(),e=Math.ceil(g.value[b]),!(n=Math.ceil(g.value[s]))||t<0||n+1<t+e||(o.handleScroll(t),o.isFront()?y.value.length&&t<=0&&A(i):o.isBehind()&&n<=e+t&&P(i))):I()},h.delay),A=H(function(){r("top"),e=y.value[0]}),P=H(function(){r("bottom")}),$=function(t){var e=h.dataKey;return(Array.isArray(e)?e:e.replace(/\[/g,".").replace(/\]/g,".").split(".")).reduce(function(t,e){return(t||{})[e]},t)},B=function(e){return y.value.findIndex(function(t){return $(e)==$(t)})};return j.watch(function(){return h.dataSource},function(t){t=t,y.value=t,z(),o&&(o.updateUniqueKeys(a.value),o.updateSizes(a.value),o.updateRange()),u?u.set("dataSource",F(t)):j.nextTick(function(){return C()}),e&&h.keepOffset&&(w(B(e)),e=null)},{deep:!0,immediate:!0}),j.watch(function(){return h.disabled},function(t){u&&u.set("disabled",t)},{immediate:!0}),j.onBeforeMount(function(){o=new it({size:h.size,keeps:h.keeps,uniqueKeys:a.value,isHorizontal:m},function(t){void 0===f.value.to.key&&(d.value=t);var e=d.value,n=e.start,t=e.end,e=f.value.from.index;-1<e&&!(n<=e&&e<=t)&&u&&(u.rangeIsChanged=!0)})}),j.onActivated(function(){E(o.offset)}),j.onUnmounted(function(){u&&u.destroy(),o=u=null}),function(){var t=h.rootTag,e=h.wrapTag,r=h.itemTag,n=h.headerTag,i=h.footerTag,o=d.value,a=o.start,s=o.end,l=o.front,o=o.behind,o=L(L({},h.wrapStyle),{},{padding:m?"0px ".concat(o,"px 0px ").concat(l,"px"):"".concat(l,"px 0px ").concat(o,"px")});return j.h(t,{ref:g,style:{overflow:m?"auto hidden":"hidden auto"},on:{"&scroll":M}},[c.header?j.h(at,{props:{tag:n,dataKey:"header",event:"onHeaderResized"},on:{onHeaderResized:D}},c.header()):null,j.h(e,{ref:p,attrs:{role:"group"},class:h.wrapClass,style:o},y.value.slice(a,s+1).map(function(t){var e=B(t),n=$(t),i=L(L({},h.itemStyle),function(t){if(!u)return{};var e=f.value.from.key;return u.rangeIsChanged&&t==e?{display:"none"}:{}}(n)),o={isHorizontal:m,dataKey:n,tag:r,event:"onItemResized"};return c.item?j.h(rt,{key:n,props:o,class:h.itemClass,style:i,on:{onItemResized:x}},c.item({record:t,index:e,dataKey:n})):j.h(r,{key:n,attrs:{"data-key":n},class:h.itemClass,style:L(L({},i),{},{height:"".concat(h.size,"px")})},n)})),c.footer?j.h(at,{props:{tag:i,dataKey:"footer",event:"onFooterResized"},on:{onFooterResized:k}},c.footer()):null,j.h("div",{ref:v,style:{width:m?"0px":"100%",height:m?"100%":"0px"}})])}}})});
